{% extends "base.html" %}

{% load static %}
{% block title%}
{{free_post.title}} | DeThatBit
{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="{% static 'free_board/free_board.css' %}" media="screen" />
{% endblock %}

{% block contents%}
<div class="content">
    <h1><a href="/free/">FreeBoard</a></h1>
    <div class="contentBox">
        <div class="contentBox_header">
            <div class="updateBtns">
                <button onclick="location.href='/free/{{free_post.pk}}/update/'">Modify</button>
                <button onclick="alert_del(); locatoin.href='/free/{{free_post.pk}}/delete/'">Delete</a></button>
            </div>
            <h2 class="title">{{free_post.title}}</h2>
            <h5 class="author">{{free_post.author.username}}</h5>
        </div>
        <div class="contentBox_body">
            <p>{{free_post.get_content_markdown|safe}}</p>
        </div>
    </div>


    <!--comment 부분-->
    <div class="commentBox">
        <div class="comment">
            {% if free_post.free_comment_set.count > 0 %}
            {% for comment in free_post.free_comment_set.all %}
            <div id="comment-{{comment.pk}}" class="cm_row">
                <span class="cm_writer">{{ comment.writer }}</span>
                <p class="cm_text">{{ comment.text | linebreaks }}</p>
                <small class="cm_time">
                    {{ comment.created_at.month }}/{{ comment.created_at.day }} {{ comment.created_at.hour }}:{{comment.created_at.minute }}
                </small>
                <ul class="cm_btns">
                    <li><button class="comment-modify-{{comment.pk}}" name="try-edit"
                            value="{{comment.pk}}">Modify</button></li>
                    <li><button onclick="location.href='/free/comment_delete/{{comment.pk}}/'">
                            Delete
                        </button></li>
                </ul>
                <div class="comment-edit-form-{{comment.pk}} hidden">
                    <form action="/free/comment_update/{{comment.pk}}/" method="POST">
                        {% csrf_token %}
                        {{comment_form}}
                        <button class="btn btn-info mt-3" type="submit"> Submit </button>
                    </form>
                    <button class="comment-edit-back" name="edit-back" value="{{comment.pk}}"> Back </button>
                </div>

                <hr>
            </div>
            {% endfor%}
            {% else %}
            <h1>댓글 없음</h1>
            {% endif %}
        </div>
        <div class="comment_form">
            <form action="/free/{{free_post.pk}}/comment_create/" method="POST">
                {% csrf_token %}
                {{comment_form}}
                <button class="btn btn-info mt-3 submitBtn" type="submit"> Submit </button>
            </form>
        </div>
    </div>
</div>
<script src="{% static 'free_board/comment_edit.js' %}"></script>
<script>
    function alert_del() {
        alert("삭제하시겠습니까?");
    }
    function isAuthor() {
        if ("{{free_post.author.id}}" != "{{user.id}}") {
            const btns = document.querySelector(".updateBtns");
            btns.classList.add("hidden");
        }
    }
    isAuthor();

</script>
{% endblock %}